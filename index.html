const renderThreeCardReading = () => {
  const questionInput = document.getElementById("quick-reading-question");
  const resultContainer = document.getElementById("three-card-result-container");
  const userQuestion = questionInput.value.trim();

  if (!userQuestion) {
    resultContainer.innerHTML = `
      <p class="text-lg text-red-400 font-semibold mt-4 animate-fade-in-up">
        Por favor, ingresa tu pregunta para que las cartas te respondan.
      </p>`;
    return;
  }

  // Mensaje mientras "baraja" las cartas
  resultContainer.innerHTML = `
    <p class="text-xl font-bold cinzel-decorative text-cyan-400 mb-6 mt-8 animate-pulse">
      <i class="fas fa-hourglass-half mr-2"></i> Barajando las cartas... 
      Siente la energía de tu pregunta: "${userQuestion}"
    </p>`;

  // Seleccionar 3 cartas únicas al azar
  const indices = new Set();
  while (indices.size < 3) indices.add(Math.floor(Math.random() * tarotCards.length));
  const randomIndices = Array.from(indices);

  const positions = ["PASADO", "PRESENTE", "FUTURO"];
  const baseURL = "https://raw.githubusercontent.com/adrianmblanes-dot/portafolio-de-Adriano/main/img/tarot/";

  // Crear los datos de las tres cartas
  const readings = randomIndices.map((index, i) => {
    const card = tarotCards[index];
    const positionName = positions[i];
    const isPositive = Math.random() < 0.5;
    const orientation = isPositive ? "derecho" : "invertido";
    const message = isPositive ? card.positive : card.shadow;

    // Asegurar nombre y número seguro
    const safeIndex = (card.index ?? index).toString().padStart(2, "0");
    const safeName = card.name
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")
      .replace(/ /g, "_");
    const imgURL = `${baseURL}${orientation}-${safeIndex}_${safeName}.jpg`;

    return { card, message, orientation, positionName, imgURL };
  });

  // Mostrar el resultado después del efecto "barajando"
  setTimeout(() => {
    const cardsHtml = readings.map(
      (r, index) => `
      <div class="card-container p-6 rounded-lg text-center animate-fade-in-up" 
           style="animation-delay:${index * 0.3}s;">
        <h3 class="text-3xl font-bold cinzel-decorative text-yellow-300 mb-4">${r.positionName}</h3> 
        <div class="flex flex-col items-center justify-center">
          <img src="${r.imgURL}" 
               alt="${r.card.name}" 
               style="height:250px;border-radius:12px;box-shadow:0 0 25px rgba(255,255,255,0.6);
                      margin-bottom:1rem;transition:transform 0.8s ease;"
               class="hover:scale-105" />
          <h4 class="text-xl font-bold cinzel-decorative text-white mb-2">${r.card.name}</h4>
          <p class="text-sm font-semibold mb-3 text-purple-300">
            ${r.orientation === "derecho" ? "Energía Positiva (Derecha)" : "En Sombra (Invertida)"}
          </p>
        </div>
        <p class="text-white/80 text-sm">${r.message}</p>
      </div>`
    ).join("");

    resultContainer.innerHTML = `
      <h3 class="text-3xl font-bold cinzel-decorative text-yellow-300 mb-6 mt-8 animate-fade-in-up">
        <i class="fas fa-magic text-cyan-400 icon-pulse-glow mr-2"></i>
        Tu Lectura Rápida de Tres Cartas
      </h3>
      <p class="text-xl font-semibold text-purple-300 mb-6 animate-fade-in-up">
        Tu pregunta: <span class="text-white italic">"${userQuestion}"</span>
      </p>

      <div class="grid md:grid-cols-3 gap-6 mb-12">
        ${cardsHtml}
      </div>

      <div class="bg-purple-900/50 p-6 rounded-lg border border-purple-400/50 animate-fade-in-up" 
           style="animation-delay: 0.8s;">
        <h4 class="text-2xl font-bold text-pink-400 mb-3 cinzel-decorative">
          <i class="fas fa-feather-alt mr-2"></i> Nota Importante
        </h4>
        <p class="text-lg text-white/80 mb-6">
          Esta es una lectura general básica y solo ofrece una orientación inicial 
          sobre tu pregunta, asignando una carta a tu Pasado, Presente y Futuro.
        </p>
        <p class="text-lg text-purple-300 font-semibold mb-6">
          Si quieres profundizar, agenda una lectura completa y personalizada conmigo.
        </p>
        <a href="#services" class="cta-button-vibrant inline-block text-xl">
          <i class="fas fa-book-reader mr-2"></i> Agenda tu Lectura Profunda Aquí
        </a>
      </div>
    `;

    questionInput.value = "";
  }, 1500);
};
